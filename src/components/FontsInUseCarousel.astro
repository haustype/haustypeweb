---
interface CarouselItem {
  image: string;
  alt: string;
  client?: string;
}

interface Props {
  items: CarouselItem[];
}

const { items } = Astro.props;
const carouselId = `carousel-${Math.random().toString(36).slice(2)}`;
---

<section class="bg-haus-grey pt-10 md:pt-12 pb-[100px]">
  <div class="w-full max-w-content mx-auto px-[30px]">
    <h2 class="text-[20px] font-normal text-black mb-8">
      Fonts In Use
    </h2>
    <div class="relative">
      <div class="carousel-viewport w-full overflow-hidden" id={`${carouselId}-viewport`}>
        <div class="carousel-track flex gap-4 transition-transform duration-300 ease-out" id={`${carouselId}-track`}>
          {items.map((item) => (
            <div class="carousel-slide flex-shrink-0 flex-[0_0_100%] md:flex-[0_0_calc(50%-8px)] lg:flex-[0_0_calc(33.333%-11px)]">
              <img
                src={item.image}
                alt={item.alt}
                width={600}
                height={400}
                class="w-full h-auto object-cover rounded-[10px]"
              />
            </div>
          ))}
        </div>
      </div>
      <button
        type="button"
        class="carousel-prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 md:-translate-x-4 w-10 h-10 flex items-center justify-center bg-haus-black text-white rounded-full hover:bg-stone-800 transition-colors focus:outline-none focus:ring-2 focus:ring-haus-red"
        aria-label="Previous slide"
        data-carousel-id={carouselId}
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <button
        type="button"
        class="carousel-next absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 md:translate-x-4 w-10 h-10 flex items-center justify-center bg-haus-black text-white rounded-full hover:bg-stone-800 transition-colors focus:outline-none focus:ring-2 focus:ring-haus-red"
        aria-label="Next slide"
        data-carousel-id={carouselId}
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>
  </div>
</section>

<script define:vars={{ carouselId }}>
  function initCarousel() {
    const viewport = document.getElementById(`${carouselId}-viewport`);
    const track = document.getElementById(`${carouselId}-track`);
    const prevBtn = document.querySelector(`button.carousel-prev[data-carousel-id="${carouselId}"]`);
    const nextBtn = document.querySelector(`button.carousel-next[data-carousel-id="${carouselId}"]`);

    if (!viewport || !track || !prevBtn || !nextBtn) return;

    const slides = track.querySelectorAll('.carousel-slide');
    if (slides.length <= 1) {
      prevBtn.setAttribute('aria-hidden', 'true');
      nextBtn.setAttribute('aria-hidden', 'true');
      return;
    }

    let index = 0;
    const total = slides.length;
    const gap = 16;

    function getSlideWidth() {
      const slide = slides[0];
      return slide ? slide.offsetWidth + gap : 0;
    }

    function updateCarousel() {
      const slideWidth = getSlideWidth();
      const offset = -index * slideWidth;
      track.style.transform = `translateX(${offset}px)`;
    }

    prevBtn.addEventListener('click', () => {
      index = (index - 1 + total) % total;
      updateCarousel();
    });

    nextBtn.addEventListener('click', () => {
      index = (index + 1) % total;
      updateCarousel();
    });

    const resizeObserver = new ResizeObserver(() => updateCarousel());
    resizeObserver.observe(viewport);

    requestAnimationFrame(() => updateCarousel());
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCarousel);
  } else {
    initCarousel();
  }
</script>
