---
interface CarouselItem {
  image: string;
  alt: string;
  client?: string;
}

interface Props {
  items: CarouselItem[];
}

const { items } = Astro.props;
---

<section class="bg-haus-grey py-10 md:py-12">
  <div class="max-w-6xl mx-auto px-4 md:px-5">
    <h2 class="text-2xl md:text-3xl font-bold text-black mb-8">
      Fonts In Use
    </h2>
    <div class="relative">
      <div class="carousel-container overflow-hidden">
        <div class="carousel-track flex gap-4" data-carousel>
          {items.map((item) => (
            <div class="carousel-slide flex-shrink-0 w-full md:w-[calc(50%-8px)] lg:w-[calc(33.333%-11px)]">
              <img
                src={item.image}
                alt={item.alt}
                width={600}
                height={400}
                class="w-full h-auto object-cover rounded-sm"
              />
            </div>
          ))}
        </div>
      </div>
      <button
        type="button"
        class="carousel-prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 md:-translate-x-4 w-10 h-10 flex items-center justify-center bg-haus-black text-white rounded-full hover:bg-stone-800 transition-colors focus:outline-none focus:ring-2 focus:ring-haus-red"
        aria-label="Previous slide"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <button
        type="button"
        class="carousel-next absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 md:translate-x-4 w-10 h-10 flex items-center justify-center bg-haus-black text-white rounded-full hover:bg-stone-800 transition-colors focus:outline-none focus:ring-2 focus:ring-haus-red"
        aria-label="Next slide"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>
  </div>
</section>

<script>
  function initCarousel() {
    const track = document.querySelector('[data-carousel]');
    if (!track) return;

    const slides = track.querySelectorAll('.carousel-slide');
    const prevBtn = document.querySelector('.carousel-prev');
    const nextBtn = document.querySelector('.carousel-next');

    if (slides.length <= 1) {
      prevBtn?.setAttribute('aria-hidden', 'true');
      nextBtn?.setAttribute('aria-hidden', 'true');
      return;
    }

    let index = 0;
    const total = slides.length;
    const gap = 16;

    function updateCarousel() {
      const slide = slides[0];
      if (!slide) return;
      const slideWidth = slide.offsetWidth + gap;
      const offset = -Math.min(index, total - 1) * slideWidth;
      track.style.transform = `translateX(${offset}px)`;
    }

    prevBtn?.addEventListener('click', () => {
      index = (index - 1 + total) % total;
      updateCarousel();
    });

    nextBtn?.addEventListener('click', () => {
      index = (index + 1) % total;
      updateCarousel();
    });

    window.addEventListener('resize', updateCarousel);
    updateCarousel();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCarousel);
  } else {
    initCarousel();
  }
</script>
