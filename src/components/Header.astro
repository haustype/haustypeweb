---
import { safeLoadQuery } from '../sanity/lib/safe-fetch';

interface Props {
  variant?: 'dark' | 'light';
}

const { variant = 'light' } = Astro.props;

const { data: settings } = await safeLoadQuery<{
  navigation?: Array<{ _type?: string; label?: string; href?: string }>;
} | null>({
  query: `*[_type == "siteSettings"][0]{
    "navigation": navigation[]{
      _type,
      _type == "internalLink" => {
        "href": "/" + page->slug.current,
        "label": page->title
      },
      _type == "builtInPage" => {
        "href": "/" + route,
        "label": select(
          route == "blog" => "Blog",
          route == "typefaces" => "Typefaces",
          route == "in-use" => "In Use",
          route
        )
      },
      _type == "externalLink" => {
        "href": url,
        "label": label
      }
    }
  }`,
});

const navItems =
  settings?.navigation?.length
    ? settings.navigation
        .filter((item) => item.label && item.href)
        .map((item) => ({ label: item.label!, href: item.href! }))
    : [
        { href: '/typefaces', label: 'Typefaces' },
        { href: '/in-use', label: 'In Use' },
        { href: '/projects', label: 'Projects' },
        { href: '/information', label: 'Information' },
      ];

const isDark = variant === 'dark';
---

<header class={isDark ? 'bg-[#0a0a0a] text-white' : 'bg-haus-grey text-[#0a0a0a]'}>
  <div class="relative z-[51] w-full max-w-content mx-auto px-8 pt-6 pb-6 grid grid-cols-1 xl:grid-cols-2 gap-8 xl:gap-16 items-center">
    <div class="flex items-center justify-between xl:justify-start">
      <a href="/" class="flex items-center gap-2 font-normal text-base tracking-tight hover:opacity-80 transition-opacity text-inherit w-fit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.5 13" class="h-[13px] w-auto shrink-0" aria-hidden="true" fill="currentColor">
          <path d="M14.444,5.814c-.072-2.239-.65-3.864-1.444-4.442,2.744.072,4.767,1.986,5.056,4.442h-3.611ZM6.5,5.814c.072-3.033.867-4.442,2.456-4.442h1.589c1.589,0,2.383,1.408,2.456,4.442h-6.5ZM13,11.628c.794-.578,1.372-2.203,1.444-4.442h3.611c-.289,2.456-2.311,4.369-5.056,4.442ZM1.444,5.814C1.733,3.358,3.756,1.444,6.5,1.372c-.794.578-1.372,2.203-1.444,4.442H1.444ZM8.956,11.628c-1.589,0-2.383-1.408-2.456-4.442h6.5c-.072,3.033-.867,4.442-2.456,4.442h-1.589ZM6.5,11.628c-2.744-.072-4.767-1.986-5.056-4.442h3.611c.072,2.239.65,3.864,1.444,4.442ZM6.789,13h5.922c3.864,0,6.789-2.781,6.789-6.5S16.575,0,12.711,0h-5.922C2.925,0,0,2.781,0,6.5s2.925,6.5,6.789,6.5Z" />
        </svg>
        Haus Type
      </a>
      <button
        type="button"
        id="nav-toggle"
        class="xl:hidden p-2 -m-2 rounded-none hover:opacity-80 transition-opacity bg-transparent border-none cursor-pointer text-inherit"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <svg class="nav-icon-open w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="butt" stroke-linejoin="miter" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg class="nav-icon-close w-6 h-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="butt" stroke-linejoin="miter" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <nav class="hidden xl:flex flex-wrap items-center gap-[2.5rem]" aria-label="Main navigation">
      {navItems.map((item) => (
        <a href={item.href} class="text-base py-2 hover:opacity-80 transition-opacity">
          {item.label}
        </a>
      ))}
      <button
        type="button"
        fontdue-click="open-store-modal"
        fontdue-store-route="cart"
        class="text-base py-2 hover:opacity-80 transition-opacity bg-transparent border-none cursor-pointer font-inherit text-inherit"
      >
        Cart
      </button>
    </nav>
  </div>
  <!-- Hamburger menu overlay (below 1280px) -->
  <div
    id="nav-menu"
    class="xl:hidden hidden fixed inset-0 z-50 flex flex-col items-center justify-center px-8 pt-16 pb-16"
    class:list={[isDark ? 'bg-[#0a0a0a] text-white' : 'bg-haus-grey text-[#0a0a0a]']}
    aria-hidden="true"
  >
    <nav class="flex flex-col gap-[1.5rem] items-center" aria-label="Mobile navigation">
      {navItems.map((item) => (
        <a href={item.href} class="text-[1.3rem] leading-[1.3] py-2 hover:opacity-80 transition-opacity">
          {item.label}
        </a>
      ))}
      <button
        type="button"
        fontdue-click="open-store-modal"
        fontdue-store-route="cart"
        class="text-[1.3rem] leading-[1.3] py-2 hover:opacity-80 transition-opacity bg-transparent border-none cursor-pointer font-inherit text-inherit"
      >
        Cart
      </button>
    </nav>
  </div>
</header>
<script>
  const toggle = document.getElementById('nav-toggle');
  const menu = document.getElementById('nav-menu');
  const iconOpen = document.querySelector('.nav-icon-open');
  const iconClose = document.querySelector('.nav-icon-close');

  toggle?.addEventListener('click', () => {
    const isOpen = menu?.classList.toggle('hidden');
    toggle?.setAttribute('aria-expanded', String(!isOpen));
    toggle?.setAttribute('aria-label', isOpen ? 'Open menu' : 'Close menu');
    menu?.setAttribute('aria-hidden', String(isOpen));
    iconOpen?.classList.toggle('hidden', !isOpen);
    iconClose?.classList.toggle('hidden', isOpen);
    document.body.style.overflow = isOpen ? '' : 'hidden';
  });
</script>
